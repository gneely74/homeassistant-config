- id: turn_off_xiaomi
  alias: 'Turn off Xiaomi Gateway light'
  initial_state: 'on'
  trigger:
   - platform: numeric_state
     entity_id: sensor.illumination_34ce00fa5b62
     above: 500
   - platform: numeric_state
     entity_id: sensor.illumination_34ce0091e54f
     above: 500
   - platform: numeric_state
     entity_id: sensor.illumination_7811dcb2413b
     above: 500
  condition:
    - condition: template
      value_template: "{{ states('trigger.event.data.entity_id') == 'on' }}"
  action:
    - service: light.turn_off
      data_template:
        entity_id: light.gateway.{{ "trigger.event.data.entity_id".split('_')[1] }}

- id: turn_on_xiaomi
  alias: 'Turn on Xiaomi Gateway light'
  initial_state: 'on'
  trigger:
   - platform: numeric_state
     entity_id: sensor.illumination_34ce00fa5b62
     above: 450
   - platform: numeric_state
     entity_id: sensor.illumination_34ce0091e54f
     above: 450
   - platform: numeric_state
     entity_id: sensor.illumination_7811dcb2413b
     above: 450
  condition:
    - condition: template
      value_template: "{{ states('trigger.event.data.entity_id') == 'off' }}"
  action:
    - service: light.turn_on
      data_template:
        entity_id: light.gateway.{{ "trigger.event.data.entity_id".split('_')[1] }}

- id: change_xiaomi_color
  alias: 'Change Xiaomi color'
  initial_state: 'on'
  condition:
    - condition: time
      after: '19:15:00'
      before: '07:45:00'
#    - condition: state
#      entity_id: binary_sensor.living_room_occupancy
#      state: 'on'
  trigger:
   - platform: time
     minutes: '/15'
     seconds: 00
  action:
     service: light.turn_on
     entity_id: light.gateway_light_34ce00fa5b62
     data_template:
       brightness: 255
       rgb_color: ['{{ (range(0, 255)|random) }}','{{ (range(0, 255)|random) }}','{{ (range(0, 255)|random) }}']
